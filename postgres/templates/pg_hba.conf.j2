# PostgreSQL Client Authentication Configuration File
# This file is managed by Ansible - do not edit manually
#
# This file controls: which hosts are allowed to connect, how clients
# are authenticated, which PostgreSQL user names they can use, which
# databases they can access.  Records take one of these forms:
#
# local      DATABASE  USER  METHOD  [OPTIONS]
# host       DATABASE  USER  ADDRESS  METHOD  [OPTIONS]
# hostssl    DATABASE  USER  ADDRESS  METHOD  [OPTIONS]
# hostnossl  DATABASE  USER  ADDRESS  METHOD  [OPTIONS]

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             postgres                                peer
local   all             all                                     peer

# IPv4 local connections:
host    all             postgres        127.0.0.1/32            md5
host    all             all             127.0.0.1/32            md5

# IPv6 local connections:
host    all             postgres        ::1/128                 md5
host    all             all             ::1/128                 md5

# Infrastructure network connections
{% for host in postgresql_allowed_hosts %}
host    all             all             {{ host }}              md5
{% endfor %}

# Application-specific connections
host    app_production  app_user        10.100.10.0/24          md5
host    app_staging     app_user        10.100.10.0/24          md5
host    all             readonly_user   10.100.10.0/24          md5

# Kubernetes worker nodes (for applications)
host    all             app_user        10.100.10.240/32        md5
host    all             app_user        10.100.10.241/32        md5
host    all             app_user        10.100.10.242/32        md5
host    all             app_user        10.100.10.243/32        md5
host    all             app_user        10.100.10.244/32        md5
host    all             app_user        10.100.10.245/32        md5

# HAProxy health checks
host    postgres        postgres        10.100.10.210/32        md5

# Backup connections
host    all             postgres        10.100.10.0/24          md5

# SSL connections (uncomment if you want to enforce SSL)
# hostssl all             all             10.100.10.0/24          md5

# Deny all other connections
# host    all             all             0.0.0.0/0               reject