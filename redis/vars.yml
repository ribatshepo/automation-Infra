---
# Redis Configuration Variables
# This file contains default configuration for Redis and Redis Stack deployments

################################## GENERAL ####################################

# Service selection - choose 'redis' for standard Redis or 'redis-stack' for Redis with modules
redis_service_type: "redis"  # Options: redis, redis-stack

################################## NETWORK ####################################

# Network binding
redis_bind_address: "127.0.0.1"
redis_port: 6379
redis_tcp_backlog: 511
redis_tcp_keepalive: 300
redis_timeout: 0

# TLS/SSL Configuration (optional)
redis_tls_enabled: false
redis_tls_port: 6380
# redis_tls_cert_file: "/etc/redis/tls/redis.crt"
# redis_tls_key_file: "/etc/redis/tls/redis.key"
# redis_tls_ca_cert_file: "/etc/redis/tls/ca.crt"

################################## PERSISTENCE ################################

# RDB Configuration
redis_save_rules:
  - "3600 1"      # Save if at least 1 key changed in 3600 seconds
  - "300 100"     # Save if at least 100 keys changed in 300 seconds
  - "60 10000"    # Save if at least 10000 keys changed in 60 seconds

redis_stop_writes_on_bgsave_error: "yes"
redis_rdbcompression: "yes"
redis_rdbchecksum: "yes"
redis_dbfilename: "dump.rdb"

# AOF Configuration
redis_appendonly: "yes"
redis_appendfilename: "appendonly.aof"
redis_appendfsync: "everysec"  # Options: always, everysec, no
redis_no_appendfsync_on_rewrite: "no"
redis_auto_aof_rewrite_percentage: 100
redis_auto_aof_rewrite_min_size: "64mb"
redis_aof_load_truncated: "yes"
redis_aof_use_rdb_preamble: "yes"

################################## MEMORY ####################################

# Memory limits and policies
# redis_maxmemory: "2gb"  # Uncomment and set appropriate value
redis_maxmemory_policy: "allkeys-lru"
redis_maxmemory_samples: 5

# Lazy freeing (non-blocking deletion)
redis_lazyfree_lazy_eviction: "no"
redis_lazyfree_lazy_expire: "no"
redis_lazyfree_lazy_server_del: "no"
redis_replica_lazy_flush: "no"

################################## SECURITY ##################################

# Authentication
redis_auth_enabled: true
redis_aclfile: "/etc/redis/users.acl"

# User accounts (passwords stored in vault.yml)
redis_app_user: "app_user"
redis_readonly_user: "readonly_user"

# Disable dangerous commands
redis_disabled_commands:
  - "FLUSHDB"
  - "FLUSHALL"
  - "KEYS"
  - "CONFIG"
  - "SHUTDOWN"
  - "DEBUG"
  - "EVAL"

################################## LOGGING ###################################

redis_loglevel: "notice"  # Options: debug, verbose, notice, warning
redis_logfile: "/var/log/redis/redis-server.log"

################################## FILES #####################################

redis_dir: "/var/lib/redis"
redis_pidfile: "/var/run/redis/redis-server.pid"
redis_databases: 16

################################## CLIENTS ###################################

redis_maxclients: 10000
redis_client_output_buffer_limit_normal: "0 0 0"
redis_client_output_buffer_limit_replica: "256mb 64mb 60"
redis_client_output_buffer_limit_pubsub: "32mb 8mb 60"
redis_client_query_buffer_limit: "1gb"
redis_proto_max_bulk_len: "512mb"

################################## PERFORMANCE ###############################

# Lua scripting
redis_lua_time_limit: 5000

# Slow log
redis_slowlog_log_slower_than: 10000
redis_slowlog_max_len: 128

# Latency monitoring
redis_latency_monitor_threshold: 100

# Advanced configuration
redis_hash_max_ziplist_entries: 512
redis_hash_max_ziplist_value: 64
redis_list_max_ziplist_size: -2
redis_list_compress_depth: 0
redis_set_max_intset_entries: 512
redis_zset_max_ziplist_entries: 128
redis_zset_max_ziplist_value: 64
redis_hll_sparse_max_bytes: 3000
redis_stream_node_max_bytes: 4096
redis_stream_node_max_entries: 100
redis_activerehashing: "yes"
redis_hz: 10
redis_dynamic_hz: "yes"
redis_aof_rewrite_incremental_fsync: "yes"
redis_rdb_save_incremental_fsync: "yes"
redis_jemalloc_bg_thread: "yes"

# Kernel optimizations
redis_oom_score_adj: "no"
redis_disable_thp: "yes"

# Event notifications (optional)
# redis_notify_keyspace_events: "Ex"

################################## REPLICATION ################################

# Master-slave configuration (optional)
# redis_slaveof_ip: "192.168.1.100"
# redis_slaveof_port: 6379
# redis_masterauth: "master_password"
redis_replica_serve_stale_data: "yes"
redis_replica_read_only: "yes"

################################## MODULES ###################################

# Additional Redis modules (optional)
# redis_modules:
#   - "/usr/lib/redis/modules/redismodule.so"

################################## INCLUDES ##################################

# Additional configuration files (optional)
# redis_include_files:
#   - "/etc/redis/local.conf"

################################## REDIS STACK #############################

# Redis Stack specific configuration
redis_stack_bind_address: "127.0.0.1"
redis_stack_port: 6379
redis_stack_tcp_backlog: 511
redis_stack_tcp_keepalive: 300
redis_stack_timeout: 0

# Redis Stack TLS
redis_stack_tls_enabled: false
redis_stack_tls_port: 6380

# Redis Stack Persistence
redis_stack_save_rules:
  - "3600 1"
  - "300 100"
  - "60 10000"

redis_stack_stop_writes_on_bgsave_error: "yes"
redis_stack_rdbcompression: "yes"
redis_stack_rdbchecksum: "yes"
redis_stack_dbfilename: "dump.rdb"
redis_stack_appendonly: "yes"
redis_stack_appendfilename: "appendonly.aof"
redis_stack_appendfsync: "everysec"
redis_stack_no_appendfsync_on_rewrite: "no"
redis_stack_auto_aof_rewrite_percentage: 100
redis_stack_auto_aof_rewrite_min_size: "64mb"
redis_stack_aof_load_truncated: "yes"
redis_stack_aof_use_rdb_preamble: "yes"

# Redis Stack Memory
# redis_stack_maxmemory: "4gb"
redis_stack_maxmemory_policy: "allkeys-lru"
redis_stack_maxmemory_samples: 5

# Redis Stack Security
redis_stack_auth_enabled: true
redis_stack_aclfile: "/etc/redis-stack/users.acl"
redis_stack_app_user: "app_user"
redis_stack_readonly_user: "readonly_user"
redis_stack_dev_user: "dev_user"

redis_stack_disabled_commands:
  - "FLUSHDB"
  - "FLUSHALL"
  - "KEYS"
  - "CONFIG"
  - "SHUTDOWN"
  - "DEBUG"
  - "EVAL"

# Redis Stack Logging
redis_stack_loglevel: "notice"
redis_stack_logfile: "/var/log/redis-stack/redis-stack-server.log"

# Redis Stack Files
redis_stack_dir: "/var/lib/redis-stack"
redis_stack_pidfile: "/var/run/redis-stack/redis-stack-server.pid"
redis_stack_databases: 16

# Redis Stack Clients
redis_stack_maxclients: 10000
redis_stack_client_output_buffer_limit_normal: "0 0 0"
redis_stack_client_output_buffer_limit_replica: "256mb 64mb 60"
redis_stack_client_output_buffer_limit_pubsub: "32mb 8mb 60"
redis_stack_client_query_buffer_limit: "1gb"
redis_stack_proto_max_bulk_len: "512mb"

# Redis Stack Performance
redis_stack_lua_time_limit: 5000
redis_stack_slowlog_log_slower_than: 10000
redis_stack_slowlog_max_len: 128
redis_stack_latency_monitor_threshold: 100
redis_stack_hash_max_ziplist_entries: 512
redis_stack_hash_max_ziplist_value: 64
redis_stack_list_max_ziplist_size: -2
redis_stack_list_compress_depth: 0
redis_stack_set_max_intset_entries: 512
redis_stack_zset_max_ziplist_entries: 128
redis_stack_zset_max_ziplist_value: 64
redis_stack_hll_sparse_max_bytes: 3000
redis_stack_stream_node_max_bytes: 4096
redis_stack_stream_node_max_entries: 100
redis_stack_activerehashing: "yes"
redis_stack_hz: 10
redis_stack_dynamic_hz: "yes"
redis_stack_aof_rewrite_incremental_fsync: "yes"
redis_stack_rdb_save_incremental_fsync: "yes"
redis_stack_jemalloc_bg_thread: "yes"
redis_stack_oom_score_adj: "no"
redis_stack_disable_thp: "yes"

# Redis Stack Module Configuration
redis_stack_search_enabled: true
redis_stack_json_enabled: true
redis_stack_timeseries_enabled: true

# Module-specific settings (optional)
# redis_stack_search_maxsearchresults: 1000000
# redis_stack_search_maxprefixexpansions: 200
# redis_stack_json_maxdepth: 128
# redis_stack_ts_maxsamplesperchunk: 1024

# Redis Stack Replication
redis_stack_replica_serve_stale_data: "yes"
redis_stack_replica_read_only: "yes"

################################## BACKUP ####################################

# Backup configuration
redis_backup_enabled: true
redis_backup_retention_days: 7
redis_backup_hour: 2
redis_backup_minute: 0

redis_stack_backup_enabled: true
redis_stack_backup_retention_days: 7
redis_stack_backup_hour: 2
redis_stack_backup_minute: 15